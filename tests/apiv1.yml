---
- config:
    - testset: "Testing API v1"

- test:
    - name: "Add new user"
    - url: "/users"
    - method: "POST"
    - body: '{"email":"test@example.org","password":"abc"}'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'application/json' }

- test:
    - name: "Add existing user"
    - url: "/users"
    - method: "POST"
    - body: '{"email":"test@example.org","password":"abc"}'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'application/json' }
    - expected_status: 409

- test:
    - name: "Add sensor to invalid user"
    - url: "/sensors"
    - method: "POST"
    - body: 'email:invalid@example.org'
    - headers: { 'X-Sensor-Version': '1'}
    - expected_status: 412

- test:
    - name: "Add sensor to not approved user"
    - url: "/sensors"
    - method: "POST"
    - body: 'email:test@example.org'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain' }
    - expected_status: 412

- test:
    - name: "Wrong approval code"
    - url: "/users/1/wrong_approval_code"
    - method: "GET"
    - expected_status: 400

- test:
    - name: "Verify user email"
    - url: "/users/1/testing_approval_code"
    - method: "GET"

- test:
    - name: "Add sensor to user"
    - url: "/sensors"
    - method: "POST"
    - body: 'email:test@example.org'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain' }

- test:
    - name: "Add sensor value"
    - url: "/sensors/1"
    - method: "POST"
    - body: "1,2,12\n1,2,23"
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain', 'X-Sensor-Api-Key': 'testing_api_key' }

- benchmark:
    - name: "Add 1000 * 1 sensor values"
    - url: "/sensors/1"
    - method: "POST"
    - body: '1,2,12'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain', 'X-Sensor-Api-Key': 'testing_api_key' }
    - warmup_runs: 0
    - benchmark_runs: '1000'
    - output_format: csv
    - metrics:
        - total_time: total
        - total_time: mean

- benchmark:
    - name: "Add 100 * 10 sensor values"
    - url: "/sensors/1"
    - method: "POST"
    - body: '1,2,12\n2,2,12\n3,2,12\n4,2,12\n5,2,12\n6,2,12\n7,2,12\n8,2,12\n9,2,12\n10,2,12'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain', 'X-Sensor-Api-Key': 'testing_api_key' }
    - warmup_runs: 0
    - benchmark_runs: '100'
    - output_format: csv
    - metrics:
        - total_time: total
        - total_time: mean

- benchmark:
    - name: "Add 10 * 100 sensor values"
    - url: "/sensors/1"
    - method: "POST"
    - body: '01,2,12\n01,2,12\n02,2,12\n03,2,12\n04,2,12\n05,2,12\n06,2,12\n07,2,12\n08,2,12\n09,2,12\n10,2,12\n12,2,12\n13,2,12\n14,2,12\n15,2,12\n16,2,12\n17,2,12\n18,2,12\n19,2,12\n20,2,12\n21,2,12\n22,2,12\n23,2,12\n24,2,12\n25,2,12\n26,2,12\n27,2,12\n28,2,12\n29,2,12\n30,2,12\n31,2,12\n32,2,12\n33,2,12\n34,2,12\n35,2,12\n36,2,12\n37,2,12\n38,2,12\n39,2,12\n40,2,12\n41,2,12\n42,2,12\n43,2,12\n44,2,12\n45,2,12\n46,2,12\n47,2,12\n48,2,12\n49,2,12\n50,2,12\n51,2,12\n52,2,12\n53,2,12\n54,2,12\n55,2,12\n56,2,12\n57,2,12\n58,2,12\n59,2,12\n60,2,12\n61,2,12\n62,2,12\n63,2,12\n64,2,12\n65,2,12\n66,2,12\n67,2,12\n68,2,12\n69,2,12\n70,2,12\n71,2,12\n72,2,12\n73,2,12\n74,2,12\n75,2,12\n76,2,12\n77,2,12\n78,2,12\n79,2,12\n80,2,12\n81,2,12\n82,2,12\n83,2,12\n84,2,12\n85,2,12\n86,2,12\n87,2,12\n88,2,12\n89,2,12\n90,2,12\n91,2,12\n92,2,12\n93,2,12\n94,2,12\n95,2,12\n96,2,12\n97,2,12\n98,2,12\n99,2,12\n100,2,12'
    - headers: { 'X-Sensor-Version': '1', 'Content-Type': 'text/plain', 'X-Sensor-Api-Key': 'testing_api_key' }
    - warmup_runs: 0
    - benchmark_runs: '10'
    - output_format: csv
    - metrics:
        - total_time: total
        - total_time: mean